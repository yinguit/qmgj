var appUnlogin = angular.module('qmgj_unlogin', ['ui.router']);
appUnlogin.config(["$stateProvider", "$urlRouterProvider", function($stateProvider, $urlRouterProvider) {
    $urlRouterProvider.otherwise('/login');
    $stateProvider
        .state('login', {
            url: '/login',
            templateUrl: '/static/app/view/login.html',
            controller: 'loginController'
        })
        .state('reg', {
            url: '/reg',
            templateUrl: '/static/app/view/reg.html',
            controller: 'regController'
        })
        .state('home', {
            url: '/home',
            templateUrl: '/static/app/view/home.html',
            controller: 'homeController'
        })
        .state('list',{
            url: '/list',
            templateUrl: '/static/app/view/list.html',
            controller: 'listController'
        })

}]);
var appLogin = angular.module('qmgj_login', ['ui.router']);
appLogin.config(["$stateProvider", "$urlRouterProvider", function($stateProvider, $urlRouterProvider) {
    $urlRouterProvider.otherwise('/home');
    $stateProvider
        .state('home', {
            url: '/home',
            templateUrl: '/static/app/view/home.html',
            controller: 'homeController'
        })
        .state('list',{
            url: '/list',
            templateUrl: '/static/app/view/list.html',
            controller: 'listController'
        })
        .state('vip',{
            url:'/vip',
            templateUrl: '/static/app/view/vip.html',
            controller: 'vipController'
        })
        .state('vip.main',{//个人主页
            url: '/main',
            templateUrl: '/static/app/view/vip.main.html',
            controller: 'vipMainController'
        })
        .state('vip.info',{// 个人信息
            url: '/info',
            templateUrl: '/static/app/view/vip.info.html',
            controller: "vipInfoController"
        })
}]);

function homeControllerFn($scope, $interval) {
    $scope.slideImg = [{
        proImg: 'static/app/images/slide1.jpg',
        proId: '1'
    }, {
        proImg: 'static/app/images/slide2.jpg',
        proId: '2'
    }];
    $scope.showIndex = 0;
    var inter = $interval(function() {
        if ($scope.showIndex >= $scope.slideImg.length - 1) {
            $scope.showIndex = 0;
            return;
        }
        $scope.showIndex++;
    }, 3500);

    $scope.showCurrentFn = function(i) {
            $scope.showIndex = i;
            // 销毁定时器
            $interval.cancel(inter);
            // 重新定义定时器
            inter = $interval(function() {
                if ($scope.showIndex >= $scope.slideImg.length - 1) {
                    $scope.showIndex = 0;
                    return;
                }
                $scope.showIndex++;
            }, 3500);
        }
        /*
        ['微电影','话剧','电影']
         */
    var hotPro = [{
        imgSrc: 'static/app/images/hot1.jpg',
        proName: '《晚秋》再现江湖',
        proCon: '蓝宝公司劳斯莱斯',
        proInfo: '超模明星足球队授权电影制作公司超模明星足球队授权电影制作公司超模明星足球队授权电影制作公司超模明星足球队授权电影制作公司',
        proType: 1,
        proProcess: '46%',
        proMoney: '1234',
        proPeople: '123',
        proDays: '12'
    }, {
        imgSrc: 'static/app/images/hot1.jpg',
        proName: '《封神传奇》再现江湖',
        proCon: '中国星',
        proInfo: '超模明星足球队授权电影制作公司超模明星足球队授权电影制作公司超模明星足球队授权电影制作公司超模明星足球队授权电影制作公司',
        proType: 2,
        proProcess: '12%',
        proMoney: '3789',
        proPeople: '323',
        proDays: '22'
    }, {
        imgSrc: 'static/app/images/hot1.jpg',
        proName: '《超脑特工》再现江湖',
        proCon: '东印度',
        proInfo: '超模明星足球队授权电影制作公司超模明星足球队授权电影制作公司超模明星足球队授权电影制作公司超模明星足球队授权电影制作公司',
        proType: 0,
        proProcess: '50%',
        proMoney: '1423',
        proPeople: '1223',
        proDays: '5'
    }];
    $scope.prosType = ['微电影', '话剧', '电影'];
    $scope.showPro = hotPro[1];
    $scope.showProIndex = $scope.showPro.proType;
    $scope.showProFn = function(i) {
        $scope.showProIndex = i;
        for (var j = 0; j < hotPro.length; j++) {
            if (hotPro[j].proType == i) {
                $scope.showPro = hotPro[j];
                break;
            }
        }
    }
}
appLogin.controller('homeController', ['$scope', '$interval', homeControllerFn]);
appUnlogin.controller('homeController', ['$scope', '$interval', homeControllerFn]);

function listControllerFn($scope, $http) {
    $scope.proTypes = [];
    $scope.proState = [];
    $scope.proTime = [];
    // 需要展示的项目数据
    $scope.proDatas = [];
    $scope.choiceType = 0; // 项目类型 微电影、电影……
    $scope.choiceState = 0; // 项目状态 筹资中……
    $scope.choiceTime = 0; // 项目进展 最新 结束 热门
    $scope.curPage = 1; // 当前是第几页的数据
    $scope.countPage = 6; // 每页面显示多少条数据 

    httpForData();
    $scope.filterData = function(e, i) {
        // filterData($event)
        // 转化为 jqlite 对象，jqlite与jquery极为相似 
        var $el = angular.element(e.target);
        var type = $el.attr('data');
        if (i == 0) {
            $scope.choiceType = type;
        } else if (i == 1) {
            $scope.choiceState = type;
        } else if (i == 2) {
            $scope.choiceTime = type;
        }
        httpForData();
    }
    function httpForData() {
        $http({
            url: 'static/app/json/listData.json',
            params: {
                choiceType: $scope.choiceType,
                choiceState: $scope.choiceState,
                choiceTime: $scope.choiceTime,
                curPage: $scope.curPage,
                countPage: $scope.countPage
            }
        }).success(function(res) {
            $scope.proTypes = res.result.proTypes;
            $scope.proState = res.result.proState;
            $scope.proTime = res.result.proTime;
            $scope.choiceType = res.result.choiceType;
            $scope.choiceState = res.result.choiceState;
            $scope.choiceTime = res.result.choiceTime;
            $scope.proDatas = res.result.data;
            $scope.curPage = 1;
            $scope.countPage = 6;
        })
    }
}
appLogin.controller('listController', ['$scope', '$http', listControllerFn]);
appUnlogin.controller('listController', ['$scope', '$http', listControllerFn]);

appUnlogin.controller('loginController',['$scope','$http',function($scope,$http){
	$scope.userLogin = function(){
		if( $scope.loginForm.$valid ){
			// post请求
			$http({
				url: '/user/login',
				method: 'post',
				data: {
					phone: $scope.phone,
					password: $scope.pwd
				}
			}).success(function(res){
				if( res.resultCode == '0000' ){
					location.reload()
				}
			});
		}
	}
}]);
appUnlogin.controller('regController',["$scope","$http","$state",function($scope,$http,$state){
	$scope.userReg = function(flag){
		if( flag ){
			$http({
				url:'/user/reg',
				method: 'post',
				data: {
					name: $scope.username,
					phone: $scope.phone,
					password: $scope.pwd,
					passwordRepeat: $scope.pwd2
				}
			}).success(function(res){
				if(res.resultCode == '0000'){
					alert('注册成功，请登录');
					$state.go('login');
				}else{
					alert( res.resultMsg );
				}
			});
		}
	}
}])
appLogin.controller('userController',['$scope','$http',function($scope,$http){
	$scope.userLogout = function(){
		$http({
			url: '/user/logout'
		}).success(function (res){
			if( res.resultCode == '0000' ){
				location.reload();
			}
		});
	}
}]);
appLogin.controller('vipController',['$scope',"$http",function($scope,$http){
	$http({
		url: 'static/app/json/userinfo.json'
	}).success(function(res){
		if(res.resultCode == '0000'){
			$scope.userinfo = res.result;
			var serverHour = new Date(parseInt(res.result.serverTime)).getHours();
			if( 7 < serverHour &&  serverHour < 12 ){
				$scope.userinfo.timeMoon = "上午"
			}else if( 12 <= serverHour && serverHour < 14 ){
				$scope.userinfo.timeMoon = "中午"
			}else if( 14 <= serverHour &&  serverHour< 18 ){
				$scope.userinfo.timeMoon = "下午"
			}else{
				$scope.userinfo.timeMoon = "晚上"
			}
		}
	});
}]);
appLogin.controller('vipInfoController',["$scope",function($scope){
	$scope.fileNameChanged = function(e){
		var $el = angular.element(e);
		var filesCount = $el[0].files.length;
		if(filesCount==0){

		}else{
			
		}
	}
}])
appLogin.controller('vipMainController',["$scope",function($scope){
	
}])